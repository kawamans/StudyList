# テストコードのコツ

mainメソッドを持つテストクラスを作成し、toString()メソッドでオブジェクトの内容をコンソールに出力して確認する方法を説明します。

---

## テストの基本的な考え方

```
テストの目的:
1. 作成したクラスやメソッドが正しく動作するか確認する
2. 期待した値が返ってくるかコンソールで目視確認する
3. エラーが発生しないか確認する
```

### テストの流れ

```
1. テスト用のクラスを作成（mainメソッドを持つ）
2. テスト対象のオブジェクトを作成
3. メソッドを実行
4. toString()で結果をコンソールに出力
5. 目視で期待通りか確認
```

---

## toString()メソッドとは

### 役割

オブジェクトの内容を文字列として表現するメソッド。
デバッグやテストで「中身を確認したい」ときに使う。

### 基本的な書き方

```java
@Override
public String toString() {
    return "クラス名{" +
            "フィールド1=" + フィールド1 +
            ", フィールド2='" + フィールド2 + "'" +
            "}";
}
```

### 書き方のルール

| データ型 | 書き方 | 例 |
|----------|--------|-----|
| int, long など数値 | そのまま | `"id=" + id` |
| String | シングルクォートで囲む | `"name='" + name + "'"` |
| オブジェクト | そのまま（nullの可能性あり） | `"createdAt=" + createdAt` |

---

## DTOにtoString()を追加する

### UserDTOの例

```java
public class UserDTO {
    private int id;
    private String username;
    private String password;
    private String email;
    private String profileImage;

    // getter/setter省略

    @Override
    public String toString() {
        return "UserDTO{" +
                "id=" + id +
                ", username='" + username + "'" +
                ", email='" + email + "'" +
                ", profileImage='" + profileImage + "'" +
                "}";
    }
}
```

**ポイント**: パスワードはセキュリティ上、toString()に含めない。

### RecipeDTOの例

```java
public class RecipeDTO {
    private int id;
    private String title;
    private String content;
    private String authorname;
    private int authorId;
    private LocalDateTime createdAt;
    private String imageFilename;

    // getter/setter省略

    @Override
    public String toString() {
        return "RecipeDTO{" +
                "id=" + id +
                ", title='" + title + "'" +
                ", content='" + content + "'" +
                ", authorname='" + authorname + "'" +
                ", authorId=" + authorId +
                ", createdAt=" + createdAt +
                ", imageFilename='" + imageFilename + "'" +
                "}";
    }
}
```

### リスト系クラスの例（RecipeList）

```java
public class RecipeList extends ArrayList<RecipeDTO> {

    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder();
        sb.append("RecipeList[\n");
        for (RecipeDTO recipe : this) {
            sb.append("  ").append(recipe.toString()).append("\n");
        }
        sb.append("]");
        return sb.toString();
    }
}
```

**ポイント**: ループで複数の文字列を連結する場合は、StringBuilderを使うと効率が良い。

---

## テストクラスの作成

### プロジェクト構成

```
src/main/java/jp/co/recipe/
├── dto/
│   ├── UserDTO.java
│   └── RecipeDTO.java
├── dao/
│   ├── UserDAO.java
│   └── RecipeDAO.java
└── test/                    ← テスト用パッケージを作成
    ├── DTOTest.java
    ├── UserDAOTest.java
    └── RecipeDAOTest.java
```

### テストクラスの基本構造

```java
package jp.co.recipe.test;

public class DTOTest {

    public static void main(String[] args) {
        System.out.println("========== テスト開始 ==========\n");

        // テスト1を実行
        test1();

        // テスト2を実行
        test2();

        System.out.println("\n========== テスト終了 ==========");
    }

    private static void test1() {
        System.out.println("【テスト1】テスト内容の説明");
        System.out.println("----------------------------------------");

        // テストコードをここに書く

        System.out.println();
    }

    private static void test2() {
        System.out.println("【テスト2】テスト内容の説明");
        System.out.println("----------------------------------------");

        // テストコードをここに書く

        System.out.println();
    }
}
```

---

## DTOのテスト例

### UserDTOのテスト

```java
package jp.co.recipe.test;

import jp.co.recipe.dto.UserDTO;

public class DTOTest {

    public static void main(String[] args) {
        System.out.println("========== DTO テスト開始 ==========\n");

        testUserDTO();

        System.out.println("\n========== テスト終了 ==========");
    }

    private static void testUserDTO() {
        System.out.println("【テスト1】UserDTO の toString()");
        System.out.println("----------------------------------------");

        // 方法1: 空のコンストラクタ + setter
        UserDTO user1 = new UserDTO();
        user1.setId(1);
        user1.setUsername("田中太郎");
        user1.setEmail("tanaka@example.com");
        user1.setProfileImage("profile.jpg");

        System.out.println("user1: " + user1.toString());

        // 方法2: 全引数コンストラクタ
        UserDTO user2 = new UserDTO(2, "山田花子", "password", "yamada@example.com", null);

        System.out.println("user2: " + user2.toString());

        System.out.println();
    }
}
```

### 期待する出力

```
========== DTO テスト開始 ==========

【テスト1】UserDTO の toString()
----------------------------------------
user1: UserDTO{id=1, username='田中太郎', email='tanaka@example.com', profileImage='profile.jpg'}
user2: UserDTO{id=2, username='山田花子', email='yamada@example.com', profileImage='null'}

========== テスト終了 ==========
```

---

## DAOのテスト例

### UserDAOのテスト

```java
package jp.co.recipe.test;

import jp.co.recipe.dao.UserDAO;
import jp.co.recipe.dto.UserDTO;

public class UserDAOTest {

    public static void main(String[] args) {
        System.out.println("========== UserDAO テスト開始 ==========\n");

        testLoginSuccess();
        testLoginFail();
        testFindById();

        System.out.println("\n========== テスト終了 ==========");
    }

    private static void testLoginSuccess() {
        System.out.println("【テスト1】ログイン成功のテスト");
        System.out.println("----------------------------------------");

        try {
            String username = "テストユーザー";
            String password = "password123";

            System.out.println("入力: username=" + username + ", password=" + password);

            UserDTO user = UserDAO.login(username, password);

            if (user != null) {
                System.out.println("結果: ログイン成功!");
                System.out.println("取得したユーザー: " + user.toString());
            } else {
                System.out.println("結果: ログイン失敗（ユーザーが見つからない）");
            }

        } catch (Exception e) {
            System.out.println("エラー発生: " + e.getMessage());
            e.printStackTrace();
        }

        System.out.println();
    }

    private static void testLoginFail() {
        System.out.println("【テスト2】ログイン失敗のテスト（間違ったパスワード）");
        System.out.println("----------------------------------------");

        try {
            String username = "テストユーザー";
            String password = "wrongpassword";

            System.out.println("入力: username=" + username + ", password=" + password);

            UserDTO user = UserDAO.login(username, password);

            if (user == null) {
                System.out.println("結果: OK（正しくnullが返された）");
            } else {
                System.out.println("結果: NG（ログインできてしまった）");
            }

        } catch (Exception e) {
            System.out.println("エラー発生: " + e.getMessage());
            e.printStackTrace();
        }

        System.out.println();
    }

    private static void testFindById() {
        System.out.println("【テスト3】findById のテスト");
        System.out.println("----------------------------------------");

        try {
            int userId = 1;

            System.out.println("入力: id=" + userId);

            UserDTO user = UserDAO.findById(userId);

            if (user != null) {
                System.out.println("結果: ユーザーが見つかった");
                System.out.println("取得したユーザー: " + user.toString());
            } else {
                System.out.println("結果: ユーザーが見つからない");
            }

        } catch (Exception e) {
            System.out.println("エラー発生: " + e.getMessage());
            e.printStackTrace();
        }

        System.out.println();
    }
}
```

---

## RecipeDAOのテスト例

```java
package jp.co.recipe.test;

import java.util.List;
import jp.co.recipe.dao.RecipeDAO;
import jp.co.recipe.dto.RecipeDTO;
import jp.co.recipe.dto.RecipeList;

public class RecipeDAOTest {

    public static void main(String[] args) {
        System.out.println("========== RecipeDAO テスト開始 ==========\n");

        testFindAll();
        testFindById();
        testSearch();

        System.out.println("\n========== テスト終了 ==========");
    }

    private static void testFindAll() {
        System.out.println("【テスト1】findAll のテスト（全件取得）");
        System.out.println("----------------------------------------");

        try {
            RecipeList recipes = RecipeDAO.findAll();

            System.out.println("取得件数: " + recipes.size() + "件");
            System.out.println(recipes.toString());

        } catch (Exception e) {
            System.out.println("エラー発生: " + e.getMessage());
            e.printStackTrace();
        }

        System.out.println();
    }

    private static void testFindById() {
        System.out.println("【テスト2】findById のテスト（1件取得）");
        System.out.println("----------------------------------------");

        try {
            int recipeId = 1;

            System.out.println("入力: id=" + recipeId);

            RecipeDTO recipe = RecipeDAO.findById(recipeId);

            if (recipe != null) {
                System.out.println("結果: レシピが見つかった");
                System.out.println(recipe.toString());
            } else {
                System.out.println("結果: レシピが見つからない");
            }

        } catch (Exception e) {
            System.out.println("エラー発生: " + e.getMessage());
            e.printStackTrace();
        }

        System.out.println();
    }

    private static void testSearch() {
        System.out.println("【テスト3】search のテスト（キーワード検索）");
        System.out.println("----------------------------------------");

        try {
            String keyword = "カレー";

            System.out.println("入力: keyword=" + keyword);

            List<RecipeDTO> recipes = RecipeDAO.search(keyword);

            System.out.println("検索結果: " + recipes.size() + "件");
            for (RecipeDTO r : recipes) {
                System.out.println("  " + r.toString());
            }

        } catch (Exception e) {
            System.out.println("エラー発生: " + e.getMessage());
            e.printStackTrace();
        }

        System.out.println();
    }
}
```

---

## テストコードのコツ

### コツ1: テストメソッドを小さく分ける

```java
// NG: 1つのメソッドで全部テスト
public static void main(String[] args) {
    // 100行のテストコード...
}

// OK: 機能ごとにメソッドを分ける
public static void main(String[] args) {
    testLogin();
    testRegister();
    testFindById();
}
```

### コツ2: 入力と期待結果を明確に出力する

```java
// NG: 何をテストしているかわからない
System.out.println(user.toString());

// OK: 入力と期待を明確に
System.out.println("入力: username=田中, password=pass123");
System.out.println("期待: ログイン成功してUserDTOが返る");
System.out.println("結果: " + user.toString());
```

### コツ3: 正常系と異常系をテストする

```java
// 正常系: 正しい入力で正しく動くか
testLoginSuccess();       // 正しいパスワードでログイン

// 異常系: 間違った入力でエラーにならないか
testLoginFail();          // 間違ったパスワード
testLoginEmptyPassword(); // 空のパスワード
```

### コツ4: エラーハンドリングを入れる

```java
private static void testFindById() {
    try {
        // テストコード

    } catch (Exception e) {
        System.out.println("エラー発生: " + e.getMessage());
        e.printStackTrace();  // スタックトレースで原因を確認
    }
}
```

### コツ5: DBを変更するテストはコメントアウト

```java
// テスト5: 新規登録（コメントアウト中 - 実行するとDBにデータが増える）
// testInsert();

// テスト6: 削除（コメントアウト中 - 実行するとDBからデータが消える）
// testDelete();
```

---

## 確認のチェックリスト

### toString()を追加したら確認すること

```
□ すべてのフィールドが出力されているか
□ パスワードなど機密情報は除外しているか
□ nullの場合も正しく表示されるか
□ 日本語が文字化けしていないか
```

### テストを実行したら確認すること

```
□ エラーが発生していないか
□ 期待した値が出力されているか
□ DBに正しくデータが保存/取得されているか
□ 異常系で正しくnullが返るか
```

---

## まとめ

```
1. DTOにtoString()を追加して、オブジェクトの中身を確認できるようにする
2. testパッケージにmainメソッドを持つテストクラスを作成
3. 「Javaアプリケーションとして実行」でテストを実行
4. コンソール出力を目視で確認して、期待通りか判断する
```

### メリット

```
・外部ライブラリ（JUnit等）が不要
・シンプルで理解しやすい
・コンソールで結果をすぐ確認できる
```

### デメリット

```
・自動判定ではなく目視確認が必要
・テストが多くなると確認が大変
・成功/失敗の記録が残らない
```

学習段階ではこの方法で十分です。プロジェクトが大きくなったらJUnitなどの自動テストフレームワークを検討しましょう。

# 1/8 コンフリクトの原因と対策

## 発生した問題

1. `git pull` 時に `.settings/org.eclipse.wst.common.component` でコンフリクト発生
2. Eclipseで「新規 → Servlet」が表示されず、Servletを作成できない

---

## 問題1: Eclipse設定ファイルのコンフリクト

### 原因

`.gitignore` に Eclipse設定ファイルを追加しても、**既にコミット済みのファイルは追跡が継続される**。

```
# 時系列
1. 初回コミット時: .gitignore には /build/ のみ
   → .classpath, .settings/ がコミットされた（追跡開始）

2. 後から .gitignore に追加:
   .settings/
   .classpath
   → 既に追跡中なので効果なし

3. 複数人が Eclipse でソースパス等を変更
   → 同じファイルを編集 → コンフリクト発生
```

### 解決方法

追跡を解除してからコミット・プッシュする：

```bash
# 追跡を解除（ローカルファイルは残る）
git rm --cached .classpath
git rm --cached -r .settings/

# コミットしてプッシュ
git commit -m "Eclipse設定ファイルの追跡を解除"
git push
```

### 予防策

**プロジェクト作成直後、最初のコミット前に `.gitignore` を設定する**

```gitignore
# Eclipse設定ファイル
.classpath
.project
.settings/
```

---

## 問題2: Servletが作成できない

### 原因

Eclipseのプロジェクト設定ファイルが不足、またはサーバーランタイム名の不一致。

#### 原因A: サーバーランタイム名の不一致

初回コミット時、`.project` と facet ファイルは正しく作成されていた。

しかし facet ファイルには以下が含まれていた：

```xml
<runtime name="Tomcat9 (Java11)"/>
```

この「Tomcat9 (Java11)」はプロジェクト作成者のEclipseで設定したサーバー名。

| 作成者のPC | 他の人のPC |
|-----------|-----------|
| Tomcat9 (Java11) | Apache Tomcat v9.0 など |
| → 一致 ✓ | → 不一致 ✗ |

**サーバー名が一文字でも違うと、Eclipseは「ランタイムが見つからない」と判断し、Facetsが正しく機能しない。**

サーバーランタイム名は各自のEclipseのローカル設定であり、Gitでは管理・確認できない。

**だから `.settings/` をGit管理しないのが正解。** 各自のサーバー名に依存しなくなる。



### 解決方法A: Eclipseで再設定

1. プロジェクトを右クリック → **Properties**
2. **Project Facets** を開く
3. 以下にチェックを入れる：
   - ☑ Dynamic Web Module (4.0)
   - ☑ Java (11)
4. 「Apply and Close」

### 解決方法B: 設定ファイルを手動作成

**`.project` ファイル（プロジェクトルートに作成）:**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<projectDescription>
	<name>java-TB</name>
	<comment></comment>
	<projects>
	</projects>
	<buildSpec>
		<buildCommand>
			<name>org.eclipse.jdt.core.javabuilder</name>
			<arguments>
			</arguments>
		</buildCommand>
		<buildCommand>
			<name>org.eclipse.wst.common.project.facet.core.builder</name>
			<arguments>
			</arguments>
		</buildCommand>
		<buildCommand>
			<name>org.eclipse.wst.validation.validationbuilder</name>
			<arguments>
			</arguments>
		</buildCommand>
	</buildSpec>
	<natures>
		<nature>org.eclipse.jem.workbench.JavaEMFNature</nature>
		<nature>org.eclipse.wst.common.modulecore.ModuleCoreNature</nature>
		<nature>org.eclipse.wst.common.project.facet.core.nature</nature>
		<nature>org.eclipse.jdt.core.javanature</nature>
		<nature>org.eclipse.wst.jsdt.core.jsNature</nature>
	</natures>
</projectDescription>
```

**`.settings/org.eclipse.wst.common.project.facet.core.xml` ファイル:**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<faceted-project>
  <fixed facet="wst.jsdt.web"/>
  <installed facet="java" version="11"/>
  <installed facet="jst.web" version="4.0"/>
  <installed facet="wst.jsdt.web" version="1.0"/>
</faceted-project>
```

ファイル作成後、Eclipseでプロジェクトを **Refresh (F5)** する。

---

## 別のPC（学校等）で作業する場合

Eclipse設定ファイルはGitで共有されないため、**各PCで初回のみ設定が必要**。

### 手順

1. `git clone` または `git pull` でプロジェクトを取得

2. Eclipseでプロジェクトをインポート
   - **File** → **Import** → **Existing Projects into Workspace**

3. Servletが作成できない場合、Project Facetsを設定：
   - プロジェクト右クリック → **Properties**
   - **Project Facets** を開く
   - 以下にチェック：
     - ☑ Dynamic Web Module (4.0)
     - ☑ Java (11)
   - 「Apply and Close」

4. サーバーランタイムを設定（必要な場合）：
   - プロジェクト右クリック → **Properties**
   - **Targeted Runtimes** を開く
   - ☑ Tomcat 9 (Java11) にチェック
   - 「Apply and Close」

これで「新規 → Servlet」が使えるようになる。

---

## プロジェクト名が作成者とチームメンバーで異なる

### 状況

| 誰 | プロジェクト名 |
|----|--------------|
| 作成者 | MeetingRoom-A |
| チームメンバー | java-TB |

### 原因

- 作成者: Eclipseで「MeetingRoom-A」という名前でプロジェクトを作成
- チームメンバー: `git clone` でリポジトリ名「java-TB」のフォルダが作成され、Eclipseがそれをプロジェクト名として認識

プロジェクト名は `.project` ファイルで定義されるが、このファイルは `.gitignore` に含まれているためGitで共有されない。

### 問題があるか

**コンテキストパスが同じなら実害なし。**

| 項目 | 影響 |
|------|------|
| アプリのURL | コンテキストパスで決まる（プロジェクト名とは別）→ 問題なし |
| Tomcatでの動作 | コンテキストパスを参照 → 問題なし |
| WARファイル名 | ビルド時に異なる名前になる可能性（軽微） |
| チーム内コミュニケーション | 「プロジェクト開いて」と言った時に混乱するかも（軽微） |

### 揃えたい場合の修正方法

Eclipseでプロジェクト名を変更：

1. プロジェクトを右クリック → **Refactor** → **Rename**
2. 新しいプロジェクト名を入力（例: MeetingRoom-A）
3. 「OK」をクリック

**注意:** `.project` は各自のローカル設定なので、他のメンバーには影響しない。揃えたい場合は各自で変更が必要。

---

## Gitの追跡の仕組み

### ファイルの状態

```
Untracked（未追跡）
  ↓ git add
Staged（ステージング）
  ↓ git commit
Tracked（追跡中）← 以降、変更が記録される
```

### 追跡の開始・解除

| やりたいこと | コマンド |
|-------------|---------|
| 追跡開始 | `git add ファイル名` → `git commit` |
| 追跡解除（ファイル残す） | `git rm --cached ファイル名` |
| 追跡解除（ファイル削除） | `git rm ファイル名` |

### .gitignore の役割

```
新規ファイル → .gitignore にある → 追跡されない ✓
既存ファイル → .gitignore に追加 → 追跡は継続 ✗
```

`.gitignore` は**新規ファイルをブロック**するだけで、**既に追跡中のファイルは解除しない**。
だから `git rm --cached` で明示的に解除が必要。

### 追跡中のファイルを確認する方法

```bash
# 全ての追跡中ファイル一覧
git ls-files

# 特定のファイルを検索
git ls-files | grep ファイル名

# 例: Eclipse設定ファイルが追跡されているか確認
git ls-files | grep -E "\.classpath|\.settings|\.project"
```

出力があれば追跡中、なければ未追跡。

---

## 教訓

1. `.gitignore` は**最初のコミット前**に設定する
2. Eclipse設定ファイル（`.project`, `.classpath`, `.settings/`）は基本的にGit管理しない
3. 設定ファイルが消えた場合は、EclipseのProject Facetsから復元できる
4. 別のPCで作業する際は、初回にProject Facetsの設定が必要
5. 追跡中のファイルは `git ls-files` で確認できる
